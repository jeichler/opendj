---
- name: Install OpenDJ
  gather_facts: false
  hosts: localhost
  vars_files:
    - vars_secrets.yml
    - vars_common.yml
    - vars_env_{{ STAGE }}.yml


  tasks:
    - name: "Combine env facts"
      set_fact:
        ENV: "{{ common | combine( specific, recursive=True) }}"

    - name: Create OpenShift Project
      k8s:
        state: present
        wait: true
        definition:
          kind: Project
          apiVersion: project.openshift.io/v1
          metadata:
            name: "{{ENV.COMMON.NAMESPACE|mandatory}}"
            annotations:
              openshift.io/description: "OpenDJ stage {{ STAGE }}"
              openshift.io/display-name: ""
       

- import_playbook: ../../components/backend-eventstore/openshift/install.yml
- import_playbook: ../../components/provider-spotify/openshift/install.yml
- import_playbook: ../../components/service-playlist/openshift/install.yml
- import_playbook: ../../components/service-web/openshift/install.yml
- import_playbook: ../../components/frontend-web/openshift/install.yml
